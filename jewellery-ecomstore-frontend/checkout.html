<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luxury Boutique - Checkout</title>
    <link rel="stylesheet" href="css/styles.css">
</head>

<body>
    <header class="site-header">
        <nav class="nav site-nav">
            <div class="nav-left">
                <a href="index.html" class="nav-link">Home</a>
                <a href="catalog.html" class="nav-link">Catalog</a>
            </div>
            <a href="index.html" class="brand">ASHADI</a>
            <div class="nav-right">
                <a href="catalog.html" class="nav-filter-btn" style="text-decoration:none;">Back to Catalog</a>
            </div>
        </nav>
    </header>

    <main class="checkout-page">
        <h1 class="checkout-title">Checkout</h1>

        <form class="checkout-form">
            <label for="name">Full Name</label>
            <input type="text" id="name" name="name" required>

            <label for="phone">Phone Number</label>
            <input type="tel" id="phone" name="phone" required>

            <label for="address">Address</label>
            <textarea id="address" name="address" rows="3" required></textarea>

            <label for="email">Email</label>
            <input type="email" id="email" name="email" required>

            <label for="payment-slip">Upload Payment Slip</label>
            <input type="file" id="payment-slip" name="payment-slip" accept="image/*,application/pdf" required>

            <button type="submit" class="btn-continue">Continue</button>
            <div style="margin-top:12px; text-align:center;">
                <a href="index.html" class="nav-link" style="color:#d4af37; text-decoration:none;">Back to Home</a>
            </div>
        </form>
    </main>

    <footer class="footer">
        <div class="footer-bottom">
            <p>Â© 2025 Luxury Boutique. All rights reserved.</p>
        </div>
    </footer>

    <script src="config.js"></script> <script>
        (function () {
            const form = document.querySelector('.checkout-form');
            const submitButton = form.querySelector('.btn-continue');
            const originalButtonText = submitButton.textContent;

            if (!form) return;

            form.addEventListener('submit', async (e) => {
                e.preventDefault(); // Prevent default browser submission
                submitButton.disabled = true;
                submitButton.textContent = 'Processing...';

                const formData = new FormData();

                // 1. Get Customer Details
                const customerDetails = {
                    customerName: document.getElementById('name').value.trim(),
                    telephoneNumber: document.getElementById('phone').value.trim(), // Match DTO field name
                    customerAddress: document.getElementById('address').value.trim(),
                    customerEmail: document.getElementById('email').value.trim()
                    // Add other fields from OrderRequestDto if needed, like totalAmount (though backend calculates it)
                };

                // 2. Append Customer Details as JSON Blob
                formData.append('orderData', new Blob([JSON.stringify(customerDetails)], {
                    type: 'application/json'
                }));

                // 3. Get and Append Slip File
                const slipInput = document.getElementById('payment-slip');
                if (slipInput.files.length === 0) {
                    alert('Please upload a payment slip.');
                    submitButton.disabled = false;
                    submitButton.textContent = originalButtonText;
                    return;
                }
                const slipFile = slipInput.files[0];
                formData.append('slipFile', slipFile);

                // 4. Send the request
                try {
                    // Make sure API_BASE_URL is defined in config.js
                    const response = await fetch(`${API_BASE_URL}/orders`, {
                        method: 'POST',
                        body: formData,
                        credentials: 'include'
                        // DO NOT set Content-Type header manually for FormData
                    });

                    if (!response.ok) {

                        let errorMsg = `Checkout failed with status: ${response.status}`;
                        try {
                            const errorData = await response.json();
                            errorMsg = errorData.message || errorMsg;

                        } catch (parseError) {

                            errorMsg = await response.text().catch(() => errorMsg);
                        }
                        throw new Error(errorMsg);
                    }

                    const result = await response.json();
                    console.log('Order created:', result);
                    alert('Order placed successfully! Order ID: ' + result.id);
                    // Redirect to a thank you page or homepage
                    window.location.href = 'index.html';

                } catch (error) {
                    console.error('Checkout error:', error);
                    alert('Error placing order: ' + error.message);
                    submitButton.disabled = false;
                    submitButton.textContent = originalButtonText;
                }
            });
        })();
    </script>

</body>
</html>


</body>

</html>